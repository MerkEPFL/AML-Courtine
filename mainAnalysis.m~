
function main()
    close all; clear all; 
    %======================================================================
    % Load Data for SCI subject
    %======================================================================
    % Data with no Crutches 
    
    datasetName1 = 'Exercise - Material - SCI Subject/FLOAT_NO_CRUTCHES/MAT/FLOAT_NO_CRUTCHES.mat';
    load(datasetName1); % load data structure   
    
    noCrutches_01 = readtable('Exercise - Material - SCI Subject/FLOAT_NO_CRUTCHES/GAIT FILES/SCI_HCU_20150505_04OVGb_45BWS_vFWD_noAD_03_GAIT.csv');
    noCrutches_02 = readtable('Exercise - Material - SCI Subject/FLOAT_NO_CRUTCHES/GAIT FILES/SCI_HCU_20150505_04OVGb_45BWS_vFWD_noAD_04_GAIT.csv');
    noCrutches_03 = readtable('Exercise - Material - SCI Subject/FLOAT_NO_CRUTCHES/GAIT FILES/SCI_HCU_20150505_04OVGb_45BWS_vFWD_noAD_05_GAIT.csv');
    
    % Data with Crutches
    
    datasetName2 = 'Exercise - Material - SCI Subject/NO_FLOAT_CRUTCHES/MAT/NO_FLOAT_CRUTCHES.mat';
    load(datasetName2); % load data structure   
    
    Crutches_01 = readtable('Exercise - Material - SCI Subject/NO_FLOAT_CRUTCHES/GAIT FILES/SCI_HCU_20150505_02OVGa_AD_01_GAIT.csv');
    Crutches_02 = readtable('Exercise - Material - SCI Subject/NO_FLOAT_CRUTCHES/GAIT FILES/SCI_HCU_20150505_02OVGa_AD_02_GAIT.csv');
    Crutches_03 = readtable('Exercise - Material - SCI Subject/NO_FLOAT_CRUTCHES/GAIT FILES/SCI_HCU_20150505_02OVGa_AD_03_GAIT.csv');
    
    
    % Create the ground truth based on the csv features 
    
%% SEGMENTATION USING CSV FILE
    %% noCrutches_01
    noCrutches_01_FS_left=[];
    noCrutches_01_FS_right=[];
    noCrutches_01_FO_left=[];
    noCrutches_01_FO_right=[];
   
    for i = 1:length(noCrutches_01.Name)
        if string(noCrutches_01.Name{i})=='Foot Strike'
            if string(noCrutches_01.Context{i}) == 'Left'
                noCrutches_01_FS_left = [noCrutches_01_FS_left double(noCrutches_01.Time_s_(i))];
            else
                noCrutches_01_FS_right = [noCrutches_01_FS_right double(noCrutches_01.Time_s_(i))];
            end
        elseif string(noCrutches_01.Name{i})=='Foot Off'
            if string(noCrutches_01.Context{i}) == 'Left'
                noCrutches_01_FO_left = [noCrutches_01_FO_left double(noCrutches_01.Time_s_(i))];
            else
                noCrutches_01_FO_right = [noCrutches_01_FO_right double(noCrutches_01.Time_s_(i))];
            end
        end
    end    
    
    %% noCrutches_02
    noCrutches_02_FS_left=[];
    noCrutches_02_FS_right=[];
    noCrutches_02_FO_left=[];
    noCrutches_02_FO_right=[];
   
    for i = 1:length(noCrutches_02.Name)
        if string(noCrutches_02.Name{i})=='Foot Strike'
            if string(noCrutches_02.Context{i}) == 'Left'
                noCrutches_02_FS_left = [noCrutches_02_FS_left double(noCrutches_02.Time_s_(i))];
            else
                noCrutches_02_FS_right = [noCrutches_02_FS_right double(noCrutches_02.Time_s_(i))];
            end
        elseif string(noCrutches_02.Name{i})=='Foot Off'
            if string(noCrutches_02.Context{i}) == 'Left'
                noCrutches_02_FO_left = [noCrutches_02_FO_left double(noCrutches_02.Time_s_(i))];
            else
                noCrutches_02_FO_right = [noCrutches_02_FO_right double(noCrutches_02.Time_s_(i))];
            end
        end
    end
    %% noCrutches_03
    noCrutches_03_FS_left=[];
    noCrutches_03_FS_right=[];
    noCrutches_03_FO_left=[];
    noCrutches_03_FO_right=[];
   
    for i = 1:length(noCrutches_03.Name)
        if string(noCrutches_03.Name{i})=='Foot Strike'
            if string(noCrutches_03.Context{i}) == 'Left'
                noCrutches_03_FS_left = [noCrutches_03_FS_left double(noCrutches_03.Time_s_(i))];
            else
                noCrutches_03_FS_right = [noCrutches_03_FS_right double(noCrutches_03.Time_s_(i))];
            end
        elseif string(noCrutches_03.Name{i})=='Foot Off'
            if string(noCrutches_03.Context{i}) == 'Left'
                noCrutches_03_FO_left = [noCrutches_03_FO_left double(noCrutches_03.Time_s_(i))];
            else
                noCrutches_03_FO_right = [noCrutches_03_FO_right double(noCrutches_03.Time_s_(i))];
            end
        end
    end
    
    
    %% Crutches_01
    Crutches_01_FS_left=[];
    Crutches_01_FS_right=[];
    Crutches_01_FO_left=[];
    Crutches_01_FO_right=[];
   
    for i = 1:length(Crutches_01.Name)
        if string(Crutches_01.Name{i})=='Foot Strike'
            if string(Crutches_01.Context{i}) == 'Left'
                Crutches_01_FS_left = [Crutches_01_FS_left double(Crutches_01.Time_s_(i))];
            else
                Crutches_01_FS_right = [Crutches_01_FS_right double(Crutches_01.Time_s_(i))];
            end
        elseif string(Crutches_01.Name{i})=='Foot Off'
            if string(Crutches_01.Context{i}) == 'Left'
                Crutches_01_FO_left = [Crutches_01_FO_left double(Crutches_01.Time_s_(i))];
            else
                Crutches_01_FO_right = [Crutches_01_FO_right double(Crutches_01.Time_s_(i))];
            end
        end
    end
%% Crutches_02
    Crutches_02_FS_left=[];
    Crutches_02_FS_right=[];
    Crutches_02_FO_left=[];
    Crutches_02_FO_right=[];
   
    for i = 1:length(Crutches_02.Name)
        if string(Crutches_02.Name{i})=='Foot Strike'
            if string(Crutches_02.Context{i}) == 'Left'
                Crutches_02_FS_left = [Crutches_02_FS_left double(Crutches_02.Time_s_(i))];
            else
                Crutches_02_FS_right = [Crutches_02_FS_right double(Crutches_02.Time_s_(i))];
            end
        elseif string(Crutches_02.Name{i})=='Foot Off'
            if string(Crutches_02.Context{i}) == 'Left'
                Crutches_02_FO_left = [Crutches_02_FO_left double(Crutches_02.Time_s_(i))];
            else
                Crutches_02_FO_right = [Crutches_02_FO_right double(Crutches_02.Time_s_(i))];
            end
        end
    end
%% Crutches_03
    Crutches_03_FS_left=[];
    Crutches_03_FS_right=[];
    Crutches_03_FO_left=[];
    Crutches_03_FO_right=[];
   
    for i = 1:length(Crutches_03.Name)
        if string(Crutches_03.Name{i})=='Foot Strike'
            if string(Crutches_03.Context{i}) == 'Left'
                Crutches_03_FS_left = [Crutches_03_FS_left double(Crutches_03.Time_s_(i))];
            else
                Crutches_03_FS_right = [Crutches_03_FS_right double(Crutches_03.Time_s_(i))];
            end
        elseif string(Crutches_03.Name{i})=='Foot Off'
            if string(Crutches_03.Context{i}) == 'Left'
                Crutches_03_FO_left = [Crutches_03_FO_left double(Crutches_03.Time_s_(i))];
            else
                Crutches_03_FO_right = [Crutches_03_FO_right double(Crutches_03.Time_s_(i))];
            end
        end
    end
    
%% PARAMETERS FROM KINEMATICS

% GAIT CYCLE TIME (GCT)

GCT_noCrutches_left = [];
GCT_noCrutches_right = [];

GCT_Crutches_left = [];
GCT_Crutches_right = [];

%to find the total time 

% time_start = 0;
% %we take one kinemtic marker, they all have the same length
% %and we define the number of points taken by the sampling frequency to get
% %the time 
% time_end = length(NO_FLOAT_CRUTCHES.T_01.Raw.Kin.LANK(:,3))/FLOAT_NO_CRUTCHES.T_01.fsKIN;
% time_step = 1/FLOAT_NO_CRUTCHES.T_01.fsKIN;
% time = time_start:time_step:time_end;

for index=1:length(noCrutches_01_FS_left)-1
    GCT_noCrutches_left = [GCT_noCrutches_left (noCrutches_01_FS_left(index+1)-noCrutches_01_FS_left(index))];
end

for index=1:length(noCrutches_02_FS_left)-1
    GCT_noCrutches_left = [GCT_noCrutches_left (noCrutches_02_FS_left(index+1)-noCrutches_02_FS_left(index))];
end

for index=1:length(noCrutches_03_FS_left)-1
    GCT_noCrutches_left = [GCT_noCrutches_left (noCrutches_03_FS_left(index+1)-noCrutches_03_FS_left(index))];
end

for index=1:length(noCrutches_01_FS_right)-1
    GCT_noCrutches_right = [GCT_noCrutches_right (noCrutches_01_FS_right(index+1)-noCrutches_01_FS_right(index))];
end

for index=1:length(noCrutches_02_FS_right)-1
    GCT_noCrutches_right = [GCT_noCrutches_right (noCrutches_02_FS_right(index+1)-noCrutches_02_FS_right(index))];
end

for index=1:length(noCrutches_03_FS_right)-1
    GCT_noCrutches_right = [GCT_noCrutches_right (noCrutches_03_FS_right(index+1)-noCrutches_03_FS_right(index))];
end


for index=1:length(Crutches_01_FS_left)-1
    GCT_Crutches_left = [GCT_Crutches_left (Crutches_01_FS_left(index+1)-Crutches_01_FS_left(index))];
end

for index=1:length(Crutches_02_FS_left)-1
    GCT_Crutches_left = [GCT_Crutches_left (Crutches_02_FS_left(index+1)-Crutches_02_FS_left(index))];
end

for index=1:length(Crutches_03_FS_left)-1
    GCT_Crutches_left = [GCT_Crutches_left (Crutches_03_FS_left(index+1)-Crutches_03_FS_left(index))];
end

for index=1:length(Crutches_01_FS_right)-1
    GCT_Crutches_right = [GCT_Crutches_right (Crutches_01_FS_right(index+1)-Crutches_01_FS_right(index))];
end

for index=1:length(Crutches_02_FS_right)-1
    GCT_Crutches_right = [GCT_Crutches_right (Crutches_02_FS_right(index+1)-Crutches_02_FS_right(index))];
end

for index=1:length(Crutches_03_FS_right)-1
    GCT_Crutches_right = [GCT_Crutches_right (Crutches_03_FS_right(index+1)-Crutches_03_FS_right(index))];
end

%%  STRIDE LENGTH (LStride)

% stride length is defined as the distance of two consequtive foot strikes
% of the same foot

LStride_noCrutches_left = [];
LStride_noCrutches_right = [];

LStride_Crutches_left = [];
LStride_Crutches_right = [];

for index=1:(length(noCrutches_01_FS_left)-1)
    timepoint1 = round(noCrutches_01_FS_left(index)*FLOAT_NO_CRUTCHES.T_01.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_01.Raw.Kin.LANK(timepoint1,:);
    timepoint2 = round(noCrutches_01_FS_left(index+1)*FLOAT_NO_CRUTCHES.T_01.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_01.Raw.Kin.LANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_left = [LStride_noCrutches_left stridelength];
end

for index=1:length(noCrutches_02_FS_left)-1
    timepoint1 = round(noCrutches_02_FS_left(index)*FLOAT_NO_CRUTCHES.T_02.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_02.Raw.Kin.LANK(timepoint1,:);
    timepoint2 = round(noCrutches_02_FS_left(index+1)*FLOAT_NO_CRUTCHES.T_02.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_02.Raw.Kin.LANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_left = [LStride_noCrutches_left stridelength];
end

for index=1:length(noCrutches_03_FS_left)-1
    timepoint1 = round(noCrutches_03_FS_left(index)*FLOAT_NO_CRUTCHES.T_03.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_03.Raw.Kin.LANK(timepoint1,:);
    timepoint2 = round(noCrutches_02_FS_left(index+1)*FLOAT_NO_CRUTCHES.T_03.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_03.Raw.Kin.LANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_left = [LStride_noCrutches_left stridelength];
end

for index=1:length(noCrutches_01_FS_right)-1
    timepoint1 = round(noCrutches_01_FS_right(index)*FLOAT_NO_CRUTCHES.T_01.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_01.Raw.Kin.RANK(timepoint1,:);
    timepoint2 = round(noCrutches_01_FS_right(index+1)*FLOAT_NO_CRUTCHES.T_01.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_01.Raw.Kin.RANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_right = [LStride_noCrutches_right stridelength];
end

for index=1:length(noCrutches_02_FS_right)-1
    timepoint1 = round(noCrutches_02_FS_right(index)*FLOAT_NO_CRUTCHES.T_02.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_02.Raw.Kin.RANK(timepoint1,:);
    timepoint2 = round(noCrutches_02_FS_right(index+1)*FLOAT_NO_CRUTCHES.T_02.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_02.Raw.Kin.RANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_right = [LStride_noCrutches_right stridelength];
end

for index=1:length(noCrutches_03_FS_right)-1
    timepoint1 = round(noCrutches_03_FS_right(index)*FLOAT_NO_CRUTCHES.T_03.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_03.Raw.Kin.RANK(timepoint1,:);
    timepoint2 = round(noCrutches_03_FS_right(index+1)*FLOAT_NO_CRUTCHES.T_03.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_03.Raw.Kin.RANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_right = [LStride_noCrutches_right stridelength];
end


for index=1:length(Crutches_01_FS_left)-1
    timepoint1 = round(noCrutches_01_FS_right(index)*FLOAT_NO_CRUTCHES.T_01.fsKIN,0);
    pt1 = FLOAT_NO_CRUTCHES.T_01.Raw.Kin.RANK(timepoint1,:);
    timepoint2 = round(noCrutches_01_FS_right(index+1)*FLOAT_NO_CRUTCHES.T_01.fsKIN,0);
    pt2 = FLOAT_NO_CRUTCHES.T_02.Raw.Kin.RANK(timepoint2,:);
    stridelength = norm(pt2-pt1);
    LStride_noCrutches_right = [LStride_noCrutches_right stridelength];
end

for index=1:length(Crutches_02_FS_left)-1
    GCT_Crutches_left = [GCT_Crutches_left (Crutches_02_FS_left(index+1)-Crutches_02_FS_left(index))];
end

for index=1:length(Crutches_03_FS_left)-1
    GCT_Crutches_left = [GCT_Crutches_left (Crutches_03_FS_left(index+1)-Crutches_03_FS_left(index))];
end

for index=1:length(Crutches_01_FS_right)-1
    GCT_Crutches_right = [GCT_Crutches_right (Crutches_01_FS_right(index+1)-Crutches_01_FS_right(index))];
end

for index=1:length(Crutches_02_FS_right)-1
    GCT_Crutches_right = [GCT_Crutches_right (Crutches_02_FS_right(index+1)-Crutches_02_FS_right(index))];
end

for index=1:length(Crutches_03_FS_right)-1
    GCT_Crutches_right = [GCT_Crutches_right (Crutches_03_FS_right(index+1)-Crutches_03_FS_right(index))];
end




%%    
    %======================================================================
    % Load Data for Healthy Patient
    %======================================================================
    